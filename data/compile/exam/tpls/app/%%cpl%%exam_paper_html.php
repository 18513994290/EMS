<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>PHPEMS模拟考试系统</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" type="text/css" href="app/core/styles/css/bootstrap.css" />
	<link rel="stylesheet" type="text/css" href="app/core/styles/css/datetimepicker.css" />
	<link rel="stylesheet" type="text/css" href="app/core/styles/css/jquery-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="app/core/styles/css/peskin.css" />
	<!--[if lt IE 9]>
	<script src="app/core/styles/js/html5shiv.min.js"></script>
	<script src="app/core/styles/js/respond.min.js"></script>
	<![endif]-->
	<script src="app/core/styles/js/jquery.min.js"></script>
	<script src="app/core/styles/js/jquery.json.js"></script>
	<script src="app/core/styles/js/jquery-ui.min.js"></script>
	<script src="app/core/styles/js/bootstrap.min.js"></script>
	<script src="app/core/styles/js/bootstrap-datetimepicker.js"></script>
	<script src="app/core/styles/js/all.fine-uploader.min.js"></script>
	<script src="app/core/styles/js/ckeditor/js/MathJax.js?config=TeX-AMS_HTML"></script>
	<script src="app/core/styles/js/ckeditor/ckeditor.js"></script>
	<script src="app/core/styles/js/plugin.js"></script>
	<script src="app/exam/styles/js/plugin.js"></script>
</head><body data-spy="scroll" data-target="#myScrollspy">
<div class="container-fluid" id="questioncontent">
	<div class="row-fluid">
		<div class="main box">
			<div class="col-xs-3" id="questionbar">
				<dl class="clear" style="width:270px;" data-spy="affix" data-offset-top="235" id="questionindex">
					<dt class="float_l"><h4>&nbsp;</h4></dt>
					<ul class="nav nav-tabs" role="tablist">
						<li role="presentation" class="active"><a href="#qt_1" aria-controls="home" role="tab" data-toggle="tab">单选题</a></li>
						<li role="presentation"><a href="#qt_2" aria-controls="home" role="tab" data-toggle="tab">填空题</a></li>
						<li role="presentation"><a href="#qt_3" aria-controls="home" role="tab" data-toggle="tab">问答题</a></li>
					</ul>
					<div class="tab-content" style="margin-top:5px;" id="questionindex">
						<div role="tabpanel" class="tab-pane tableindex active" id="qt_1">
							<a id="sign_4975" href="javascript:;" onclick="javascript:" class="btn btn-default ">全部</a>
							<a id="sign_4975" href="javascript:;" onclick="javascript:gotoquestion('4975')" class="btn btn-default ">逆向</a>
							<a id="sign_4975" href="javascript:;" onclick="javascript:gotoquestion('4975')" class="btn btn-default ">车机</a>
						</div>
						<div role="tabpanel" class="tab-pane tableindex" id="qt_2">
							<a id="sign_4996" href="javascript:;" onclick="javascript:gotoquestion('4995')" class="btn btn-default ">全部</a>
							<a id="sign_4975" href="javascript:;" onclick="javascript:gotoquestion('4975')" class="btn btn-default ">APP</a>
							<a id="sign_4975" href="javascript:;" onclick="javascript:gotoquestion('4975')" class="btn btn-default ">车机</a>
						</div>
						<div role="tabpanel" class="tab-pane tableindex" id="qt_3">
							<a id="sign_4996" href="javascript:;" onclick="javascript:gotoquestion('4996')" class="btn btn-default">全部</a>
							<a id="sign_4975" href="javascript:;" onclick="javascript:gotoquestion('4975')" class="btn btn-default">逆向</a>
							<a id="sign_4975" href="javascript:;" onclick="javascript:gotoquestion('4975')" class="btn btn-default">APP</a>
						</div>
					</div>
				</dl>
				<div class="float_l list-group" id="Topic-list">
					<div>22222222222222222222222222222222</div>
					<div>22222222222222222222222222222222</div>
					<div>22222222222222222222222222222222</div>
				</div>
			</div>

			<form id="form1" name="form1" method="post" action="index.php?exam-app-exam-score" class="col-xs-9 split pull-right" style="padding:0px;">
				<div class="box itembox questionpanel" id="questype_1">
					<!--<blockquote class="questype">单选题</blockquote>-->
				</div>
				<div class="box itembox paperexamcontent" id="questions_detail" rel="1">
					<h4 class="title"> 第4题 <span class="pull-right"> <a class="btn btn-info qicon" href="javascript:;" onclick="javascript:signQuestion('4997',this);"><i class="glyphicon glyphicon-bookmark"></i></a> <a name="question_4997"> <input id="time_4997" type="hidden" name="time[4997]" /> </a></span><a name="question_4997"> </a></h4>
					<a name="question_4997"> </a>
					<div class="choice">
						<a> </a>下列（）不属于押运途中操作规范。
					</div>
					<div class="choice">
						<p>A: 严守行车路线</p>
						<p>B: 严密观察情况</p>
						<p>C: 认真车辆例保</p>
						<p>D: 遵守交通法规</p>
					</div>
					<div class="selector">
						<label class="radio-inline"><input type="radio" name="question[4997]" rel="4997" value="A" />A </label>
						<label class="radio-inline"><input type="radio" name="question[4997]" rel="4997" value="B" />B </label>
						<label class="radio-inline"><input type="radio" name="question[4997]" rel="4997" value="C" />C </label>
						<label class="radio-inline"><input type="radio" name="question[4997]" rel="4997" value="D" />D </label>
					</div>
					<!--
					<div class="toolbar">
						<a class="btn btn-default" onclick="javascript:gotoindexquestion(2);"><span class="glyphicon glyphicon-chevron-left"></span>上一题</a>
						<a class="pull-right btn btn-primary" onclick="javascript:gotoindexquestion(4);">下一题<span class="glyphicon glyphicon-chevron-right"></span></a>
					</div>-->
				</div>
				<h3 class="text-center">
					<input type="hidden" name="insertscore" value="1"/>
					<a class="btn btn-primary" style="font-size:1em;width:270px;" href="#submodal" role="button" data-toggle="modal">确认</a>
				</h3>
			</form>
		</div>
	</div>
</div>
<div class="modal fade" id="submodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">确认</h4>
			</div>
			<div class="modal-footer">
				<button type="button" onclick="javascript:submitPaper();" class="btn btn-primary">确定</button>
				<button aria-hidden="true" class="btn" type="button" data-dismiss="modal">再检查一下</button>
			</div>
		</div>
	</div>
</div>
<div id="dg" style="z-index: 9999; position: fixed ! important; right: 0px; top: 10%;background-color:rgba(255,255,255,0.15)" class="panel-heading" >
	<table width=""100% style="position: absolute; width:260px; right: 0px; top: 0px;" class="table-hover">
		<tr id="ranktable">
			<th>排名</th>
			<th>队伍名称</th>
			<th>分数</th>
		</tr>
		<tr id="rank">
		</tr>
	</table>

</div>
<script type="text/javascript">
    var qindex = 0;
    function gotoquestion(questid)
    {
        $(".questionpanel").hide();
        $(".paperexamcontent").hide();
        $("#questions_"+questid).show();
        $("#questype_"+$("#questions_"+questid).attr('rel')).show();
    }
    function gotoindexquestion(index)
    {
        $(".questionpanel").hide();
        $(".paperexamcontent").hide();
        $(".paperexamcontent").eq(index).show();
        $("#questype_"+$(".paperexamcontent").eq(index).attr('rel')).show();
    }
    $(document).ready(function(){
        $.get('index.php?exam-app-index-ajax-lefttime&rand'+Math.random(),function(data){
            console.log(data)
            // var setting = {
            //     time:90,
            //     hbox:$("#timer_h"),
            //     mbox:$("#timer_m"),
            //     sbox:$("#timer_s"),
            //     finish:function(){
            //         submitPaper();
            //     }
            // }
            // setting.lefttime = parseInt(data);
            // countdown(setting);
        });

        (function(){
            $(".questionpanel").hide();
            $(".questionpanel:first").show();
            $(".paperexamcontent").hide();
            $(".paperexamcontent:first").show();
        })();

        setInterval(saveanswer,120000);

        initData = $.parseJSON(storage.getItem('questions'));
        if(initData){
            for(var p in initData){
                if(p!='set')
                    formData[p]=initData[p];
                $("#time_"+$('[name="'+p+'"]').attr('rel')).val(initData[p].time);
            }

            var textarea = $('#form1 textarea');
            $.each(textarea,function(){
                var _this = $(this);
                if(initData[_this.attr('name')])
                {
                    _this.val(initData[_this.attr('name')].value);
                    CKEDITOR.instances[_this.attr('id')].setData(initData[_this.attr('name')].value);
                    if(initData[_this.attr('name')].value && initData[_this.attr('name')].value != '')
                        batmark(_this.attr('rel'),initData[_this.attr('name')].value);
                }
            });
            var texts = $('#form1 :input[type=text]');
            $.each(texts,function(){
                var _this = $(this);
                if(initData[_this.attr('name')])
                {
                    _this.val(initData[_this.attr('name')]?initData[_this.attr('name')].value:'');
                    if(initData[_this.attr('name')].value && initData[_this.attr('name')].value != '')
                        batmark(_this.attr('rel'),initData[_this.attr('name')].value);
                }
            });

            var radios = $('#form1 :input[type=radio]');
            $.each(radios,function(){
                var _= this, v = initData[_.name]?initData[_.name].value:null;
                var _this = $(this);
                if(v!=''&&v==_.value){
                    _.checked = true;
                    batmark(_this.attr('rel'),initData[_this.attr('name')].value);
                }else{
                    _.checked=false;
                }
            });

            var checkboxs=$('#form1 :input[type=checkbox]');
            $.each(checkboxs,function(){
                var _=this,v=initData[_.name]?initData[_.name].value:null;
                var _this = $(this);
                if(v!=''&&v==_.value){
                    _.checked=true;
                    batmark(_this.attr('rel'),initData[_this.attr('name')].value);
                }else{
                    _.checked=false;
                }
            });
        }

        $('#form1 :input[type=text]').change(function(){
            var _this=$(this);
            var p=[];
            p.push(_this.attr('name'));
            p.push(_this.val());
            p.push(Date.parse(new Date())/1000);
            $('#time_'+_this.attr('rel')).val(Date.parse(new Date())/1000);
            set.apply(formData,p);
            markQuestion(_this.attr('rel'),true);
        });

        $('#form1 :input[type=radio]').change(function(){
            var _=this;
            var _this=$(this);
            var p=[];
            p.push(_.name);
            if(_.checked){
                p.push(_.value);
                p.push(Date.parse(new Date())/1000);
                $('#time_'+_this.attr('rel')).val(Date.parse(new Date())/1000);
                set.apply(formData,p);
            }else{
                p.push('');
                p.push(null);
                set.apply(formData,p);
            }
            markQuestion(_this.attr('rel'));
        });

        $('#form1 textarea').change(function(){
            var _= this;
            var _this=$(this);
            var p=[];
            p.push(_.name);
            p.push(_.value);
            p.push(Date.parse(new Date())/1000);
            $('#time_'+_this.attr('rel')).val(Date.parse(new Date())/1000);
            set.apply(formData,p);
            markQuestion(_this.attr('rel'),true);
        });
        $('#form1 :input[type=checkbox]').change(function(){
            var _= this;
            var _this = $(this);
            var p=[];
            p.push(_.name);
            if(_.checked){
                p.push(_.value);
                p.push(Date.parse(new Date())/1000);
                $('#time_'+_this.attr('rel')).val(Date.parse(new Date())/1000);
                set.apply(formData,p);
            }else{
                p.push('');
                p.push(null);
                set.apply(formData,p);
            }
            markQuestion(_this.attr('rel'));
        });
        $('.allquestionnumber').html($('.paperexamcontent').length);
        $('.yesdonumber').html($('#questionindex .btn-primary').length);
    });

    //排名榜
    setInterval(function(){
        var rank =$("#rank");

        var URL="index.php?exam-app-exam-rank";
        $.post(URL,'',function (result) {
            console.log(result)
            if(!result)	return false;
            var td ='';
            $.each(result,function (i,item) {
                td+=rankdata(i+1,item[0],item[1]);
            })
            if(td){
                $("#ranktable").next().nextAll().remove();//清空数据榜
                rank.after(td);
            }

        },"json");

    },500);

    function rankdata(i,name,score)
    {
        var td='';
        td+="<tr>";
        td+='<td>'+i+'</td>';
        td+='<td>'+name+'</td>';
        td+='<td>'+score+'</td>';
        td+="</tr>";
        return td;
    }

//题详情
function Opendetail() {
    var html ="";
    html+="<h4 class=\"title\">";
    html+="第1题";
    //     <span class="pull-right">
    //     <a class="btn btn-info qicon" href="javascript:;" onclick="javascript:signQuestion('4975',this);"><i class="glyphicon glyphicon-bookmark"></i></a>
    // <a name="question_4975">
    //     <input id="time_4975" type="hidden" name="time[4975]"/>
    //     </span>
    html+="</h4>";
    //     <div class="choice">
    //     </a>下列对保安押运的主要任务描述错误的是（）。					</div>
    // <div class="choice">
    //     <p>A: 为金融单位等提供武装押运安全服务
    // </p><p>B: 金库守护是保安押运公司的本职任务和基本形式
    // </p><p>C: 武装押运是保安押运公司的本职任务和基本形式
    // </p><p>D:  为金融单位等提供武装安全守护服务</p>                    </div>
    // <div class="selector">
    //     <label class="radio-inline"><input type="radio" name="question[4975]" rel="4975" value="A" />A </label>
    //     <label class="radio-inline"><input type="radio" name="question[4975]" rel="4975" value="B" />B </label>
    //     <label class="radio-inline"><input type="radio" name="question[4975]" rel="4975" value="C" />C </label>
    //     <label class="radio-inline"><input type="radio" name="question[4975]" rel="4975" value="D" />D </label>
    //     </div>
    //     <div class="toolbar">
    //     <a class="pull-right btn btn-primary" onclick="javascript:gotoindexquestion(1);">下一题<span class="glyphicon glyphicon-chevron-right"></span></a>
    // </div>";

    $("#questions_detail").append(html);

}


</script>
</body>
</html>